import rich_click as click
from rich.console import Console
from rich.table import Table
from pyfiglet import Figlet

from IDOREnumeration import *

def display_banner():
    f = Figlet(font="dos_rebel")
    console = Console()
    console.print(f.renderText("LVS"))
    console.print("Lightweight Vulnerability Scanner - Developed by Rich Hoggan\n")

@click.group()
def cli():
    """
    Lightweight Vulnerability Scanner (LVS) is a vulnerability scanner which looks for
    web based vulnerabilities. It's intended to use targeted analysis without generating
    a large amount of traffic.
    Disclaimer: LVS is not intended to be a replacement of other tools and scanners.
    """

@click.command()
@click.option("--url", help="The target url to scan")
@click.option("--param", help="The parameter being enumerated")
def ienum(url, param):
    """The IDOR enumerator accepts a target URL and parameter, and enumerates the IDOR vulnerability
    displaying the results"""
    display_banner()
    console = Console()

    console.print(f"[*] Scanning {url}")
    console.print(f"[*] Enumerating {param} query string parameter")
    console.print("[*] Scan in progress...")

    enumerator_results = idor_enumerator(target_url=url, query_parameter=param)

    console.print("[*] Generating results...\n")
    table = Table(title="Scan Results")
    table.add_column("URL", style="green")
    table.add_column("Username", style="green")
    table.add_column("Type", style="green")

    for result in enumerator_results:
        if result.is_user:
            table.add_row(result.url, result.username.split(":")[1], result.type.split(":")[1])
    console.print(table)

if __name__ == "__main__":
    cli.add_command(ienum)
    cli()